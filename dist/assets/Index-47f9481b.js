import{c as _,r as F,j as R,a as v,u as he,b as me,s as pe}from"./index-27b3262d.js";import{a as ye}from"./axios-47b9d439.js";var ee={},Y={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getListFiles=t.getImage=t.getBase64=t.getAcceptTypeString=t.openFileDialog=void 0,t.openFileDialog=function(i){i.current&&i.current.click()},t.getAcceptTypeString=function(i,r){return i!=null&&i.length?i.map(function(u){return"."+u}).join(", "):r?"":"image/*"},t.getBase64=function(i){var r=new FileReader;return new Promise(function(u){r.addEventListener("load",function(){return u(String(r.result))}),r.readAsDataURL(i)})},t.getImage=function(i){var r=new Image;return new Promise(function(u){r.addEventListener("load",function(){return u(r)}),r.src=URL.createObjectURL(i)})},t.getListFiles=function(i,r){for(var u=[],d=0;d<i.length;d+=1)u.push(t.getBase64(i[d]));return Promise.all(u).then(function(e){var o=e.map(function(l,f){var n;return n={},n[r]=l,n.file=i[f],n});return o})}})(Y);var te={},T={};Object.defineProperty(T,"__esModule",{value:!0});T.DEFAULT_DATA_URL_KEY=T.INIT_MAX_NUMBER=T.DEFAULT_NULL_INDEX=void 0;T.DEFAULT_NULL_INDEX=-1;T.INIT_MAX_NUMBER=1e3;T.DEFAULT_DATA_URL_KEY="dataURL";(function(t){var i=_&&_.__awaiter||function(e,o,l,f){function n(a){return a instanceof l?a:new l(function(h){h(a)})}return new(l||(l=Promise))(function(a,h){function m(p){try{s(f.next(p))}catch(g){h(g)}}function w(p){try{s(f.throw(p))}catch(g){h(g)}}function s(p){p.done?a(p.value):n(p.value).then(m,w)}s((f=f.apply(e,o||[])).next())})},r=_&&_.__generator||function(e,o){var l={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},f,n,a,h;return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(s){return function(p){return w([s,p])}}function w(s){if(f)throw new TypeError("Generator is already executing.");for(;l;)try{if(f=1,n&&(a=s[0]&2?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[s[0]&2,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,n=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(s[0]===6||s[0]===2)){l=0;continue}if(s[0]===3&&(!a||s[1]>a[0]&&s[1]<a[3])){l.label=s[1];break}if(s[0]===6&&l.label<a[1]){l.label=a[1],a=s;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(s);break}a[2]&&l.ops.pop(),l.trys.pop();continue}s=o.call(e,l)}catch(p){s=[6,p],n=0}finally{f=a=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorValidation=t.isMaxNumberValid=t.isAcceptTypeValid=t.isMaxFileSizeValid=t.isImageValid=t.isResolutionValid=void 0;var u=T,d=Y;t.isResolutionValid=function(e,o,l,f){if(l===void 0&&(l=0),f===void 0&&(f=1),!l||!f||!e.width||!e.height)return!0;switch(o){case"absolute":{if(e.width===l&&e.height===f)return!0;break}case"ratio":{var n=l/f;if(e.width/e.height===n)return!0;break}case"less":{if(e.width<=l&&e.height<=f)return!0;break}case"more":{if(e.width>=l&&e.height>=f)return!0;break}}return!1},t.isImageValid=function(e){return!!e.includes("image")},t.isMaxFileSizeValid=function(e,o){return o?e<=o:!0},t.isAcceptTypeValid=function(e,o){if(e&&e.length>0){var l=o.split(".").pop()||"";if(e.findIndex(function(f){return f.toLowerCase()===l.toLowerCase()})<0)return!1}return!0},t.isMaxNumberValid=function(e,o,l){if(o!==0&&!o)return!0;if(l===u.DEFAULT_NULL_INDEX){if(e<=o)return!0}else if(e<=o+1)return!0;return!1},t.getErrorValidation=function(e){var o=e.fileList,l=e.value,f=e.maxNumber,n=e.keyUpdate,a=e.acceptType,h=e.maxFileSize,m=e.resolutionType,w=e.resolutionWidth,s=e.resolutionHeight,p=e.allowNonImageType;return i(void 0,void 0,void 0,function(){var g,b,L,U,I;return r(this,function(N){switch(N.label){case 0:return g={},t.isMaxNumberValid(o.length+l.length,f,n)?[3,1]:(g.maxNumber=!0,[3,5]);case 1:b=0,N.label=2;case 2:return b<o.length?(L=o[b].file,L?!p&&!t.isImageValid(L.type)?(g.acceptType=!0,[3,5]):t.isAcceptTypeValid(a,L.name)?t.isMaxFileSizeValid(L.size,h)?m?[4,d.getImage(L)]:[3,4]:(g.maxFileSize=!0,[3,5]):(g.acceptType=!0,[3,5]):[3,4]):[3,5];case 3:if(U=N.sent(),I=t.isResolutionValid(U,m,w,s),!I)return g.resolution=!0,[3,5];N.label=4;case 4:return b+=1,[3,2];case 5:return Object.values(g).find(Boolean)?[2,g]:[2,null]}})})}})(te);var G=_&&_.__assign||function(){return G=Object.assign||function(t){for(var i,r=1,u=arguments.length;r<u;r++){i=arguments[r];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(t[d]=i[d])}return t},G.apply(this,arguments)},_e=_&&_.__createBinding||(Object.create?function(t,i,r,u){u===void 0&&(u=r),Object.defineProperty(t,u,{enumerable:!0,get:function(){return i[r]}})}:function(t,i,r,u){u===void 0&&(u=r),t[u]=i[r]}),be=_&&_.__setModuleDefault||(Object.create?function(t,i){Object.defineProperty(t,"default",{enumerable:!0,value:i})}:function(t,i){t.default=i}),we=_&&_.__importStar||function(t){if(t&&t.__esModule)return t;var i={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&_e(i,t,r);return be(i,t),i},x=_&&_.__awaiter||function(t,i,r,u){function d(e){return e instanceof r?e:new r(function(o){o(e)})}return new(r||(r=Promise))(function(e,o){function l(a){try{n(u.next(a))}catch(h){o(h)}}function f(a){try{n(u.throw(a))}catch(h){o(h)}}function n(a){a.done?e(a.value):d(a.value).then(l,f)}n((u=u.apply(t,i||[])).next())})},B=_&&_.__generator||function(t,i){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},u,d,e,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(n){return function(a){return f([n,a])}}function f(n){if(u)throw new TypeError("Generator is already executing.");for(;r;)try{if(u=1,d&&(e=n[0]&2?d.return:n[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,n[1])).done)return e;switch(d=0,e&&(n=[n[0]&2,e.value]),n[0]){case 0:case 1:e=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,d=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(n[0]===6||n[0]===2)){r=0;continue}if(n[0]===3&&(!e||n[1]>e[0]&&n[1]<e[3])){r.label=n[1];break}if(n[0]===6&&r.label<e[1]){r.label=e[1],e=n;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(n);break}e[2]&&r.ops.pop(),r.trys.pop();continue}n=i.call(t,r)}catch(a){n=[6,a],d=0}finally{u=e=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}},z=_&&_.__spreadArrays||function(){for(var t=0,i=0,r=arguments.length;i<r;i++)t+=arguments[i].length;for(var u=Array(t),d=0,i=0;i<r;i++)for(var e=arguments[i],o=0,l=e.length;o<l;o++,d++)u[d]=e[o];return u};Object.defineProperty(ee,"__esModule",{value:!0});var D=we(F),K=Y,Le=te,E=T,Ne=function(t){var i=t.value,r=i===void 0?[]:i,u=t.onChange,d=t.onError,e=t.children,o=t.dataURLKey,l=o===void 0?E.DEFAULT_DATA_URL_KEY:o,f=t.multiple,n=f===void 0?!1:f,a=t.maxNumber,h=a===void 0?E.INIT_MAX_NUMBER:a,m=t.acceptType,w=t.maxFileSize,s=t.resolutionWidth,p=t.resolutionHeight,g=t.resolutionType,b=t.inputProps,L=b===void 0?{}:b,U=t.allowNonImageType,I=U===void 0?!1:U,N=r||[],j=D.useRef(null),$=D.useState(E.DEFAULT_NULL_INDEX),S=$[0],V=$[1],J=D.useState(null),Z=J[0],q=J[1],Q=D.useState(!1),ne=Q[0],O=Q[1],P=D.useCallback(function(){return K.openFileDialog(j)},[j]),re=D.useCallback(function(){V(E.DEFAULT_NULL_INDEX),P()},[P]),ae=D.useCallback(function(){u==null||u([])},[u]),ie=function(c){var y=z(N);Array.isArray(c)?c.forEach(function(A){y.splice(A,1)}):y.splice(c,1),u==null||u(y)},le=function(c){V(c),P()},ue=function(c){return x(void 0,void 0,void 0,function(){var y;return B(this,function(A){switch(A.label){case 0:return[4,Le.getErrorValidation({fileList:c,maxFileSize:w,maxNumber:h,acceptType:m,keyUpdate:S,resolutionType:g,resolutionWidth:s,resolutionHeight:p,value:N,allowNonImageType:I})];case 1:return y=A.sent(),y?(q(y),d==null||d(y,c),[2,!1]):(Z&&q(null),[2,!0])}})})},W=function(c){return x(void 0,void 0,void 0,function(){var y,A,k,C,H,M;return B(this,function(X){switch(X.label){case 0:return c?[4,K.getListFiles(c,l)]:[2];case 1:return y=X.sent(),y.length?[4,ue(y)]:[2];case 2:if(A=X.sent(),!A)return[2];if(C=[],S>E.DEFAULT_NULL_INDEX)H=y[0],k=z(N),k[S]=H,C.push(S);else if(n)for(k=z(N,y),M=N.length;M<k.length;M+=1)C.push(M);else k=[y[0]],C.push(0);return u==null||u(k,C),[2]}})})},oe=function(c){return x(void 0,void 0,void 0,function(){return B(this,function(y){switch(y.label){case 0:return[4,W(c.target.files)];case 1:return y.sent(),S>E.DEFAULT_NULL_INDEX&&V(E.DEFAULT_NULL_INDEX),j.current&&(j.current.value=""),[2]}})})},se=D.useMemo(function(){return K.getAcceptTypeString(m,I)},[m,I]),ce=function(c){c.preventDefault(),c.stopPropagation()},fe=function(c){c.preventDefault(),c.stopPropagation(),c.dataTransfer.items&&c.dataTransfer.items.length>0&&O(!0)},de=function(c){c.preventDefault(),c.stopPropagation(),O(!1)},ge=function(c){c.preventDefault(),c.stopPropagation(),O(!1),c.dataTransfer.files&&c.dataTransfer.files.length>0&&W(c.dataTransfer.files)},ve=function(c){c.preventDefault(),c.stopPropagation(),c.dataTransfer.clearData()};return D.default.createElement(D.default.Fragment,null,D.default.createElement("input",G({type:"file",accept:se,ref:j,multiple:n&&S===E.DEFAULT_NULL_INDEX,onChange:oe,style:{display:"none"}},L)),e==null?void 0:e({imageList:N,onImageUpload:re,onImageRemoveAll:ae,onImageUpdate:le,onImageRemove:ie,errors:Z,dragProps:{onDrop:ge,onDragEnter:fe,onDragLeave:de,onDragOver:ce,onDragStart:ve},isDragging:ne}))},De=ee.default=Ne;const Ie=({className:t})=>R("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:t,children:[v("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),v("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Ue=()=>{const[t,i]=F.useState([]);F.useState([]);const r=69,u=(m,w)=>{!w||w.length===0||(n(!0),w.forEach(s=>{const p=m[s],g=new FormData;g.append("file",p.file),fetch("http://127.0.0.1:3001/file/upload",{method:"POST",body:g}).then(b=>b.json()).then(b=>{fetch("http://127.0.0.1:3001/images",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({image:b.data.filename})}).then(L=>L.json()).then(L=>{console.log("first",L)}),console.log("data",b)}).catch(b=>console.error("Error:",b))}),i(m),n(!1))},{t:d,i18n:e}=he(),[o,l]=F.useState(!0),[f,n]=F.useState(!1),a=localStorage.getItem("token"),h=me();return F.useEffect(()=>{ye.get("http://127.0.0.1:3001/images",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}}).then(m=>{l(!1)})},[]),F.useEffect(()=>{h(pe(d("Tải ảnh mới lên")))}),v("div",{children:R("div",{className:"panel mb-5",children:[o&&v("div",{className:"w-full flex",children:v("span",{className:"animate-spin border-4 border-transparent border-l-primary rounded-full w-12 h-12 inline-block align-middle m-auto mb-10"})}),!o&&v("div",{className:"mb-5",children:R("div",{className:"custom-file-container","data-upload-id":"mySecondImage",children:[R("div",{className:"label-container",children:[v("label",{children:"Upload "}),v("button",{type:"button",className:"custom-file-container__image-clear",title:"Clear Image",onClick:()=>{i([])},children:"×"})]}),v("label",{className:"custom-file-container__custom-file"}),v("input",{type:"file",className:"custom-file-container__custom-file__custom-file-input",accept:"image/*"}),v("input",{type:"hidden",name:"MAX_FILE_SIZE",value:"10485760"}),v(De,{multiple:!0,value:t,onChange:u,maxNumber:r,children:({imageList:m,onImageUpload:w,onImageRemoveAll:s,onImageUpdate:p,onImageRemove:g,isDragging:b,dragProps:L})=>R("div",{className:"upload__image-wrapper",children:[v("button",{className:"custom-file-container__custom-file__custom-file-control",onClick:w,children:"Choose File..."})," ",v("div",{className:"grid gap-4 sm:grid-cols-3 grid-cols-1",children:m.map((U,I)=>R("div",{className:"custom-file-container__image-preview relative",children:[v("button",{type:"button",className:"custom-file-container__image-clear bg-dark-light dark:bg-dark dark:text-white-dark rounded-full block w-fit p-0.5 absolute top-0 left-0",title:"Clear Image",onClick:()=>g(I),children:v(Ie,{className:"w-3 h-3"})}),v("img",{src:U.dataURL,alt:"img",className:"object-cover shadow rounded w-full !max-h-48"})]},I))})]})}),f&&v("img",{src:"/assets/images/loading.svg",className:"max-w-md w-full m-auto mb-8",alt:"",style:{height:"100px"}}),t.length===0&&!f?v("img",{src:"/assets/images/file-preview.svg",className:"max-w-md w-full m-auto",alt:""}):""]})})]})})};export{Ue as default};
